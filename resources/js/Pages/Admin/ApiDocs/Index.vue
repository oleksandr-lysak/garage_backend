<template>
    <Head title="API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è" />

    <div class="py-12">
        <div class="max-w-7xl mx-auto sm:px-6 lg:px-8">
            <div class="bg-white overflow-hidden shadow-sm sm:rounded-lg">
                <div class="p-6 text-gray-900">
                    <h1 class="text-2xl font-bold mb-6">API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–æ–≥–æ –¥–æ–¥–∞—Ç–∫—É</h1>

                    <div class="space-y-8">
                        <!-- Authentication Section -->
                        <section>
                            <h2 class="text-xl font-semibold mb-4 text-blue-600">üîê –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è</h2>

                            <div class="bg-gray-50 p-4 rounded-lg space-y-4">
                                <div>
                                    <h3 class="font-semibold text-green-600">1. –ó–∞–ø–∏—Ç OTP –∫–æ–¥—É</h3>
                                    <div class="bg-black text-green-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>POST /api/auth/request-otp</div>
                                        <div class="text-gray-300">Content-Type: application/json</div>
                                        <div class="mt-2">
                                            {<br>
                                            &nbsp;&nbsp;"phone": "+380501234567"<br>
                                            }
                                        </div>
                                    </div>
                                    <div class="mt-2 text-sm text-gray-600">
                                        <strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å:</strong> { "message": "OTP sent", "needs_registration": false }
                                    </div>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-green-600">2. –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è OTP –∫–æ–¥—É</h3>
                                    <div class="bg-black text-green-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>POST /api/auth/verify-otp</div>
                                        <div class="text-gray-300">Content-Type: application/json</div>
                                        <div class="mt-2">
                                            {<br>
                                            &nbsp;&nbsp;"phone": "+380501234567",<br>
                                            &nbsp;&nbsp;"sms_code": "1234"<br>
                                            }
                                        </div>
                                    </div>
                                    <div class="mt-2 text-sm text-gray-600">
                                        <strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å:</strong><br>
                                        {<br>
                                        &nbsp;&nbsp;"user": { "id": 1, "name": "Master 4567", "phone": "+380501234567" },<br>
                                        &nbsp;&nbsp;"access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",<br>
                                        &nbsp;&nbsp;"refresh_token": "abc123def456...",<br>
                                        &nbsp;&nbsp;"expires_in": 3600<br>
                                        }
                                    </div>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-green-600">3. –û–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—É</h3>
                                    <div class="bg-black text-green-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>POST /api/auth/refresh</div>
                                        <div class="text-gray-300">Content-Type: application/json</div>
                                        <div class="mt-2">
                                            {<br>
                                            &nbsp;&nbsp;"refresh_token": "abc123def456..."<br>
                                            }
                                        </div>
                                    </div>
                                    <div class="mt-2 text-sm text-gray-600">
                                        <strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å:</strong><br>
                                        {<br>
                                        &nbsp;&nbsp;"access_token": "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9...",<br>
                                        &nbsp;&nbsp;"refresh_token": "xyz789uvw012...",<br>
                                        &nbsp;&nbsp;"expires_in": 3600<br>
                                        }
                                    </div>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-green-600">4. –û—Ç—Ä–∏–º–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞</h3>
                                    <div class="bg-black text-green-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>GET /api/auth/me</div>
                                        <div class="text-gray-300">Authorization: Bearer {access_token}</div>
                                    </div>
                                    <div class="mt-2 text-sm text-gray-600">
                                        <strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å:</strong><br>
                                        {<br>
                                        &nbsp;&nbsp;"user": { "id": 1, "name": "Master 4567", "phone": "+380501234567" }<br>
                                        }
                                    </div>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-green-600">5. –í–∏—Ö—ñ–¥ –∑ —Å–∏—Å—Ç–µ–º–∏</h3>
                                    <div class="bg-black text-green-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>POST /api/auth/logout</div>
                                        <div class="text-gray-300">Authorization: Bearer {access_token}</div>
                                        <div class="text-gray-300">Content-Type: application/json</div>
                                        <div class="mt-2">
                                            {<br>
                                            &nbsp;&nbsp;"refresh_token": "abc123def456..."<br>
                                            }
                                        </div>
                                    </div>
                                    <div class="mt-2 text-sm text-gray-600">
                                        <strong>–í—ñ–¥–ø–æ–≤—ñ–¥—å:</strong> { "message": "Successfully logged out" }
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Token Management Section -->
                        <section>
                            <h2 class="text-xl font-semibold mb-4 text-blue-600">‚è∞ –£–ø—Ä–∞–≤–ª—ñ–Ω–Ω—è —Ç–æ–∫–µ–Ω–∞–º–∏</h2>

                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-yellow-800 mb-2">–í–∞–∂–ª–∏–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è:</h3>
                                <ul class="text-sm text-yellow-700 space-y-1">
                                    <li>‚Ä¢ <strong>Access Token</strong> –¥—ñ–π—Å–Ω–∏–π 60 —Ö–≤–∏–ª–∏–Ω (1 –≥–æ–¥–∏–Ω–∞)</li>
                                    <li>‚Ä¢ <strong>Refresh Token</strong> –¥—ñ–π—Å–Ω–∏–π 14 –¥–Ω—ñ–≤</li>
                                    <li>‚Ä¢ –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ refresh_token –ª–æ–∫–∞–ª—å–Ω–æ –≤ –¥–æ–¥–∞—Ç–∫—É</li>
                                    <li>‚Ä¢ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –æ–Ω–æ–≤–ª—é–π—Ç–µ access_token –ø—Ä–∏ –∑–∞–∫—ñ–Ω—á–µ–Ω–Ω—ñ</li>
                                    <li>‚Ä¢ –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—é –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –¥–æ–¥–∞—Ç–∫—É</li>
                                </ul>
                            </div>
                        </section>

                        <!-- Implementation Guide Section -->
                        <section>
                            <h2 class="text-xl font-semibold mb-4 text-blue-600">üì± –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è –¥–ª—è —Ä–æ–∑—Ä–æ–±–Ω–∏–∫–∞</h2>

                            <div class="bg-blue-50 p-4 rounded-lg space-y-4">
                                <div>
                                    <h3 class="font-semibold text-blue-800">1. –ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—ñ–≤</h3>
                                    <div class="bg-black text-blue-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>// Flutter example</div>
                                        <div>class TokenStorage {</div>
                                        <div>&nbsp;&nbsp;static const String _accessTokenKey = 'access_token';</div>
                                        <div>&nbsp;&nbsp;static const String _refreshTokenKey = 'refresh_token';</div>
                                        <div>&nbsp;&nbsp;static const String _tokenExpiryKey = 'token_expiry';</div>
                                        <div>&nbsp;&nbsp;</div>
                                        <div>&nbsp;&nbsp;static Future&lt;void&gt; saveTokens(String accessToken, String refreshToken, DateTime expiry) async {</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;final prefs = await SharedPreferences.getInstance();</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;await prefs.setString(_accessTokenKey, accessToken);</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;await prefs.setString(_refreshTokenKey, refreshToken);</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;await prefs.setString(_tokenExpiryKey, expiry.toIso8601String());</div>
                                        <div>&nbsp;&nbsp;}</div>
                                        <div>}</div>
                                    </div>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-blue-800">2. –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó –ø—Ä–∏ —Å—Ç–∞—Ä—Ç—ñ</h3>
                                    <div class="bg-black text-blue-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>class AuthService {</div>
                                        <div>&nbsp;&nbsp;Future&lt;bool&gt; checkAuthStatus() async {</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;final token = await TokenStorage.getAccessToken();</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;if (token == null) return false;</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;if (!await TokenStorage.isTokenValid()) {</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return await refreshToken();</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;}</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;return true;</div>
                                        <div>&nbsp;&nbsp;}</div>
                                        <div>}</div>
                                    </div>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-blue-800">3. –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —Ç–æ–∫–µ–Ω—É</h3>
                                    <div class="bg-black text-blue-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>Future&lt;bool&gt; refreshToken() async {</div>
                                        <div>&nbsp;&nbsp;final refreshToken = await TokenStorage.getRefreshToken();</div>
                                        <div>&nbsp;&nbsp;if (refreshToken == null) return false;</div>
                                        <div>&nbsp;&nbsp;</div>
                                        <div>&nbsp;&nbsp;try {
                                        </div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;final response = await http.post(</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Uri.parse('$baseUrl/api/auth/refresh'),</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;headers: {'Content-Type': 'application/json'},</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: json.encode({'refresh_token': refreshToken}),</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;);</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;if (response.statusCode == 200) {</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;final data = json.decode(response.body);</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;await TokenStorage.saveTokens(</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data['access_token'],</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data['refresh_token'],</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DateTime.now().add(Duration(hours: 1)),</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return true;</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;}</div>
                                        <div>&nbsp;&nbsp;} catch (e) {</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;print('Token refresh failed: $e');</div>
                                        <div>&nbsp;&nbsp;}</div>
                                        <div>&nbsp;&nbsp;return false;</div>
                                        <div>}</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Error Handling Section -->
                        <section>
                            <h2 class="text-xl font-semibold mb-4 text-blue-600">‚ö†Ô∏è –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫</h2>

                            <div class="bg-red-50 p-4 rounded-lg space-y-3">
                                <div>
                                    <h3 class="font-semibold text-red-800">–ö–æ–¥–∏ –ø–æ–º–∏–ª–æ–∫:</h3>
                                    <ul class="text-sm text-red-700 space-y-1">
                                        <li>‚Ä¢ <strong>400</strong> - –ù–µ–≤—ñ—Ä–Ω–∏–π OTP –∫–æ–¥</li>
                                        <li>‚Ä¢ <strong>401</strong> - –ù–µ–≤—ñ—Ä–Ω–∏–π –∞–±–æ –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π —Ç–æ–∫–µ–Ω</li>
                                        <li>‚Ä¢ <strong>422</strong> - –í—ñ–¥—Å—É—Ç–Ω—ñ–π refresh_token</li>
                                        <li>‚Ä¢ <strong>500</strong> - –í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞</li>
                                    </ul>
                                </div>

                                <div>
                                    <h3 class="font-semibold text-red-800">–ü—Ä–∏–∫–ª–∞–¥ –æ–±—Ä–æ–±–∫–∏:</h3>
                                    <div class="bg-black text-red-400 p-3 rounded font-mono text-sm mt-2">
                                        <div>try {</div>
                                        <div>&nbsp;&nbsp;final response = await http.post(...);</div>
                                        <div>&nbsp;&nbsp;if (response.statusCode == 401) {</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;// –¢–æ–∫–µ–Ω –ø—Ä–æ—Å—Ç—Ä–æ—á–µ–Ω–∏–π, —Å–ø—Ä–æ–±—É–≤–∞—Ç–∏ –æ–Ω–æ–≤–∏—Ç–∏</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;final refreshed = await refreshToken();</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;if (!refreshed) {</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;// –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ –µ–∫—Ä–∞–Ω –≤—Ö–æ–¥—É</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;navigateToLogin();</div>
                                        <div>&nbsp;&nbsp;&nbsp;&nbsp;}</div>
                                        <div>&nbsp;&nbsp;}</div>
                                        <div>} catch (e) {</div>
                                        <div>&nbsp;&nbsp;print('Request failed: $e');</div>
                                        <div>}</div>
                                    </div>
                                </div>
                            </div>
                        </section>

                        <!-- Base URL Section -->
                        <section>
                            <h2 class="text-xl font-semibold mb-4 text-blue-600">üåê –ë–∞–∑–æ–≤–∏–π URL</h2>

                            <div class="bg-green-50 p-4 rounded-lg">
                                <div class="text-sm text-green-700">
                                    <strong>–†–æ–∑—Ä–æ–±–∫–∞:</strong> http://localhost:100<br>
                                    <strong>–ü—Ä–æ–¥–∞–∫—à–Ω:</strong> https://your-domain.com
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { Head } from '@inertiajs/vue3';
</script>
